{% extends "layouts/owner_base.html" %}

{% block title %}Pet Care Management - My Appointments{% endblock %}

{% block page_title %}ðŸ“… My Appointments{% endblock %}

{% block content %}
<div class="d-flex justify-content-end mb-3">
  <a href="/book_appointment" class="btn btn-success">ðŸ“… Book New Appointment</a>
</div>

<div class="card">
  <div class="card-body">
    <table class="table table-bordered table-hover align-middle">
      <thead class="table-light">
        <tr>
          <th>#</th>
          <th>Pet Name</th>
          <th>Veterinarian</th>
          <th>Specialization</th>
          <th>Date & Time</th>
          <th>Status</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        {% for appointment in appointments %}
        <tr>
          <td>{{ loop.index }}</td>
          <td>{{ appointment.pet_name }}</td>
          <td>{{ appointment.vet_name }}</td>
          <td>{{ appointment.specialization or 'General' }}</td>
          <td>{{ appointment.appointment_date.strftime('%Y-%m-%d %H:%M') }}</td>
          <td>
            <span class="badge bg-{{ 'warning' if appointment.status == 'Pending' else 'success' if appointment.status == 'Confirmed' else 'primary' if appointment.status == 'Completed' else 'danger' }}">
              {{ appointment.status }}
            </span>
          </td>
          <td>
            {% if appointment.status == 'Pending' %}
            <button class="btn btn-danger btn-sm" onclick="cancelAppointment({{ appointment.appointment_id }})">Cancel</button>
            {% else %}
            <span class="text-muted">-</span>
            {% endif %}
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>

    {% if not appointments %}
    <div class="text-center py-4">
      <p class="text-muted">No appointments found.</p>
      <a href="/book_appointment" class="btn btn-primary">Book Your First Appointment</a>
    </div>
    {% endif %}
  </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
  function cancelAppointment(appointmentId) {
    if (confirm('Are you sure you want to cancel this appointment?')) {
      fetch('/cancel_appointment', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({ appointment_id: appointmentId })
      })
      .then(response => response.json())
      .then(data => {
        alert(data.message);
        if (data.success) {
          location.reload();
        }
      })
      .catch(error => {
        console.error('Error:', error);
        alert('An error occurred while cancelling the appointment.');
      });
    }
  }
</script>
{% endblock %}